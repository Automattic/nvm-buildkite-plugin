#!/bin/bash

set -euo pipefail

# Use the NVM_DIR environment variable set by the pre-command hook
nvm_dir="${NVM_DIR:-}"

# Only remove directories that have our marker file to ensure we only clean up
# directories created by our plugin
if [[ -d "$nvm_dir" && -f "$nvm_dir/.automattic-nvm-dir-marker" ]]; then
    echo "~~~ :node: Uninstalling Node.js"
    echo "Removing $nvm_dir"
    rm -rf "$nvm_dir"
    echo "Node.js successfully removed."
else
    echo "~~~ :node: No Node.js installation to uninstall"
    echo "NVM_DIR is not set or directory does not exist: $nvm_dir"
fi
